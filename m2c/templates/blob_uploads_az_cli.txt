#!/bin/bash

# Bash shell script to upload mongoexport blobs to Azure Storage with the az CLI.
#
# Database Name: {{ dbname }}
# Generated on:  {{ gen_timestamp }}
# Generated by:  {{ gen_by }}
# Template:      blob_uploads_az_cli.txt

source env.sh

# Uncomment as necessary:
# echo 'acct: '$M2C_STORAGE_ACCOUNT
# echo 'key:  '$M2C_STORAGE_KEY

{% for c in collections %}
echo '---'
echo 'uploading {{ c['local_file_path'] }} to {{ container }} ...'
date 
az storage blob upload \
  --container-name {{ container }} \
  --file {{ c['local_file_path'] }} \
  --name  {{ c['blob_name'] }} \
  --account-name $M2C_STORAGE_ACCOUNT \
  --account-key $M2C_STORAGE_KEY
{% endfor %}

date

#echo ''
#echo 'listing contents of container: {{ container }}'
#az storage blob list -c {{ container }} \
#  --auth-mode key \
#  --account-name $M2C_STORAGE_ACCOUNT \
#  --account-key $M2C_STORAGE_KEY

echo 'done'
