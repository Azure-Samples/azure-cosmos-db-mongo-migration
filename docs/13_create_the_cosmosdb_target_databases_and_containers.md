# 13 - Create the CosmosDB Target Databases and Containers

**This step is typically executed from a Developer laptop.**

## Execute the xxx_cosmos_db_containers_az_cli.sh scripts

One such script will be generated for each of your target CosmosDB databases,
where xxx is a target DB name.  **execute each of these scripts**.

The script will look like the following; it will use the **az CLI** to create
your database and then its collections/containers.

```
#!/bin/bash

# Bash shell script to create an autoscaled database, with containers
# in a CosmosDB/Mongo account.
#
# Database Name: travel
# Generated on:  2021-06-13 12:32:30 UTC
# Generated by:  artifact_generator.py gen_target_cosmos_az_create()
# Template:      cosmos_db_containers_az_cli.txt

source env.sh

echo 'creating cosmos db: travel'
az cosmosdb mongodb database create \
    --resource-group $M2C_RG \
    --account-name $M2C_COSMOS_MONGODB_ACCT \
    --name travel \
    --max-throughput 5000

echo 'creating cosmos collection: airlines'
az cosmosdb mongodb collection create \
    --resource-group $M2C_RG \
    --account-name $M2C_COSMOS_MONGODB_ACCT \
    --database-name travel \
    --name airlines \
    --shard pk

echo 'creating cosmos collection: airports'
az cosmosdb mongodb collection create \
    --resource-group $M2C_RG \
    --account-name $M2C_COSMOS_MONGODB_ACCT \
    --database-name travel \
    --name airports \
    --shard pk

echo 'creating cosmos collection: countries'
az cosmosdb mongodb collection create \
    --resource-group $M2C_RG \
    --account-name $M2C_COSMOS_MONGODB_ACCT \
    --database-name travel \
    --name countries \
    --shard pk

echo 'creating cosmos collection: planes'
az cosmosdb mongodb collection create \
    --resource-group $M2C_RG \
    --account-name $M2C_COSMOS_MONGODB_ACCT \
    --database-name travel \
    --name planes \
    --shard pk

echo 'creating cosmos collection: routes'
az cosmosdb mongodb collection create \
    --resource-group $M2C_RG \
    --account-name $M2C_COSMOS_MONGODB_ACCT \
    --database-name travel \
    --name routes \
    --shard pk

echo 'done'
```

The CosmosDB Request Units (RUs) will be shared amongst the containers of the database 
per the **--max-throughput** setting.  The value of 5000 this case came from the customer-edited 
**mappings** file as shown here:

```
{
  "source_dbname": "openflights",
  "default_target_dbname": "travel",
  "cosmos_db_autoscale_ru": 5000,       <-- max shared RU value
  ...
```

Likewise, the shard or partition key values come from the mappings file:

```
  ...
  "collections": [
    {
      "name": "airlines",
      "mapping": {
        "target_dbname": "travel",
        "target_container": "airlines",
        "wrangling_algorithm": "standard",
        "pk_name": "pk",                     <-- partition key attribute name
        ...
```
