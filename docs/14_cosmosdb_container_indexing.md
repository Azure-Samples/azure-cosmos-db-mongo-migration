# 14 - CosmosDB Container Indexing

For each target CosmosDB database, this process will generate two files;
a "ddl" file, and a shell script which executes the ddl file.

For example, where xxx is one of your database names:

```
reference_app/artifacts/shell/mongo_indexes_xxx_db.sh
reference_app/artifacts/shell/mongo/mongo_indexes_xxx_db.ddl
```

**This step is typically executed from a Developer laptop.**

## Edit the Cosmos/Mongo Index Files

The generated **"ddl"** (borrowing the term Data Definition Language from relational databases)
will be commented-out and look like the following:

```
// MongoDB "DDL" create the indexes in the "travel" database
// and its collections.
//
// Generated on: 2021-06-13 12:32:30 UTC
// Generated by: artifact_generator.py gen_target_cosmos_mongo_indexes()
// Template:     mongo_database_indexes.ddl
// TODO:         the customer needs to manually edit the this file

use travel

// db.airlines.ensureIndex({"some_attribute" : 1}, {"unique" : false})

// db.airports.ensureIndex({"some_attribute" : 1}, {"unique" : false})

// db.countries.ensureIndex({"some_attribute" : 1}, {"unique" : false})

// db.planes.ensureIndex({"some_attribute" : 1}, {"unique" : false})

// db.routes.ensureIndex({"some_attribute" : 1}, {"unique" : false})

show collections
```

Since this migrator project has no knowledge of the query patterns in your application, 
**you are required to edit the ddl files to contain the indexes that are appropriate for your app.**


## Execute the Generated Scripts

**This will connect to CosmosDB via the mongo shell program** and add the indexes to your collections.

```
mongo $M2C_COSMOS_MONGO_CONN_STRING --ssl < mongo/mongo_indexes_travel_db.ddl
```

```
$ ./mongo_indexes_travel_db.sh
init database travel ...
...
MongoDB shell version v4.4.5
connecting to: mongodb://cjoakimm2ccosmosmongo.mongo.cosmos.azure.com:10255/....&ssl=true
Implicit session: session { "id" : UUID("76e...2da") }
MongoDB server version: 4.0.0
WARNING: shell and server versions do not match
switched to db travel
airlines
airports
countries
planes
routes
bye
```
